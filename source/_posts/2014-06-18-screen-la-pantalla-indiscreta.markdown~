---
layout: post
title: "screen, la pantalla indiscreta"
date: 2014-06-18 22:30
comments: true
categories: linux,cisco
---

{% img right /images/posts/screen.png 'screen' %}

Antes de preparar una serie de entradas dedicadas a la configuración y despliegue de switches *(Cisco Catalyst)* voy a dedicar algunos artículos a la herramienta que utilizo para hacer estas tareas.

La herramienta básica y más importante, al menos durante las labores de configuración inicial, es un cliente que nos permita establecer una conexión vía consola con los switches. Aunque hay muchas alternativas[^1], existe una aplicación que por su potencia y versatilidad no debería faltar en ningún equipo que funcione con LiNUX, [screen](http://linux.die.net/man/1/screen).

En este primer post dedicado a *screen* vamos a ver su funcionalidad como cliente para conectarse a una consola serie junto con los comandos más habituales para trabajar de forma cómoda.

<!-- more -->

*Screen* es una herramienta muy polivalente que nos permite disponer de múltiples ventanas ([shells](https://es.wikipedia.org/wiki/Shell_de_UNIX)) dentro de una sesión, con la peculiaridad de que lo que se está ejecutando en estas ventanas se puede mantener en ejecución al abandonarlas. No sólo eso, podemos volver a conectarnos desde cualquier otra consola a una sesión previamente establecida retomando el estado de las ventanas tal como se encontraban al dejarlas.

Además de lo anterior, que de por sí ya es una funcionalidad más que interesante en el trabajo con servidores, nos permite establecer conexiones a través del puerto serie (puerto de consola en switches) con todos aquellos dispositivos que dispongan de este tipo de conectores.

## Conceptos

1.  **Sesión:** Es el área de trabajo creada al ejecutar el comando.
2.  **Ventana:** Son las *shells* que se abren dentro de la sesión. 

También es posible mantener varias ventanas en la misma sesión separadas en **regiones** (horizontales y/o verticales).

## Conexión a una consola serie

Antes de lanzar el comando para conectarnos a la consola del switch, hay que identificar en el ordenador el dispositivo serie:

``` sh
dmesg | grep tty
```
Este comando nos devolverá el dispositivo con una nomenclatura del tipo `ttySX` o `ttyUSBX`(donde *X* es un valor numérico, habitualmente 0).

Con esta información ya podemos utilizar el comando *screen* para conectarnos:

``` sh
screen /dev/ttyXXXX baud_rate,cs8|cs7,ixon|-ixon,ixoff|-ixoff,istrip|-istrip
```

Donde:

`/dev/ttyXXXX`: Puerto serie.   
`baud_rate`: Habitualmente 300, 1200, 9600 o 19200.   
`cs8` o `cs7`: Transmisión de 8 o 7 bits por byte.   
`ixon` o `-ixon`: Habilita o deshabilita el control de flujo por software (en envío).   
`ixoff` o `-ixoff`: Habilita o deshabilita el control de flujo por software (en recepción).   
`istrip` o `-istrip`: Elimina o mantiene el octavo bit de cada byte recibido.   

> Todos los switches Cisco Catalyst disponen de un puerto de consola accesible con los parámetros:
>
> * Connection speed = 9600 bps
> * Data bits = 8
> * Parity = None
> * Stop bits = 1
> * Flow control = None

Para conectarnos utilizaremos el siguiente comando:

``` sh
screen /dev/ttyUSB0 9600,cs8,-ixon,-ixoff,-istrip
```

O en su forma abreviada:

``` sh
screen /dev/ttyUSB0
```

## Comandos básicos

Como este artículo está enfocado al uso de *screen* para realizar una conexión vía consola (a un switch), sólo vamos a ver los comandos imprescindibles para realizar esta tarea.

Combinación de Teclas | Tarea 
:-------------------: | :------------------------------------ 
`CTRL + a` + `?`      | Ayuda (lista de comandos)
`CTRL + a` + `i`      | Información y estado del puerto serie
`CTRL + a` + `k`      | Cerrar la sesión actual

## Resumen

Los pasos para conectarnos a una consola serie con *screen* son los siguientes:

1. Determinar el dispositivo serie en el equipo: `dmesg | grep tty`
2. Conectarse: `screen /dev/ttyUSB0`
3. Hacer los cambios necesarios
4. Desconectarse: `CTRL + a` + `k` 

En una próxima entrada seguiremos descubriendo las múltiples capacidades del poderoso **screen**.

## Referencias

[5 Linux / Unix Commands For Connecting To The Serial Console](http://www.cyberciti.biz/hardware/5-linux-unix-commands-for-connecting-to-the-serial-console/)

[Screen User's Manual](https://www.gnu.org/software/screen/manual/screen.html)

[^1]: Disponemos de clientes completos como [Putty](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html) y [minicom](http://linux.die.net/man/1/minicom) además de herramientas más sencillas como [cu](http://linux.die.net/man/1/cu)




